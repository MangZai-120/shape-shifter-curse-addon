# Addon Development Summary

## Recent Changes: SP Snow Fox Implementation

### 1. Stats and Attributes
- **Health**: 8 Hearts (+1 vs Familiar).
- **Environment Modifiers**:
    - **Hot/Nether**: -2 Hearts, -15% Speed.
    - **Cold**: +2 Hearts, +15% Speed.
- **Physics**:
    - **Friction**: Added `form_snow_fox_sp_no_slip.json` with attribute modifier `-0.38` to generic movement speed to normalize control on ice.

### 2. Frost Energy System ("Mana")
- **Resource**: `my_addon:form_snow_fox_sp_resource` (Range 0-100).
- **Regeneration Logic**:
    - **Combat Cooldown**: Taking damage resets a 5-second (100 tick) timer.
    - **Natural Regen**: After 5 seconds of safety, regenerates at 3/sec.
    - **Actions**: Attacks do *not* restore energy. Energy potions disabled.
- **HUD**:
    - Custom renderer `SnowFoxSPManaBar.java`.
    - Textures: `sp_snow_fox_mana_bar_*.png`.

### 3. Administration
- **Command Updated**: `/ssc-addon set_mana <targets> <amount>`
    - Replaces `set_frost`.
    - Supports setting energy for both **SP Snow Fox** (Frost Value) and **SP Familiar** (Global Mana).
    - Usage: `/ssc-addon set_mana @s 100` or `/ssc-addon set_mana PlayerName 50`.

### 4. UI/Rendering
- **Mana Bar Positioning**:
    - **SP Snow Fox Bar**: Now dynamically loads position settings from the main mod's `ClientConfig`.
    - Matches **SP Familiar** energy bar location.
    - Uses Reflection to ensure compatibility with main mod versions.

### 6. Bug Fixes
- **Natural Regen Fix**:
    - Problem: Natural regeneration of Frost value was not working.
    - Cause: Apoli JSON used relative referencing (`*:cooldown_resource`) which may be failing.
    - Solution: Replaced all references with explicit ID `my_addon:form_snow_fox_sp_frost_regen_cooldown_resource`.

### 7. Form Switching Mechanic
- **Implemented**: Melee/Ranged Toggle for SP Snow Fox.
- **Trigger**: Sneak + Primary Active Key.
- **Visual Feedback**: Added Actionbar title ("Changed to Melee/Ranged Form") to verify activation.
- **Cooldowns**:
    - **Toggle CD**: 5 seconds.
    - **Frost Gain CD**: 15 seconds.
    - **Regen Pause**: 5 seconds after gain.
- **Effects**:
    - **Melee (State 0)**: +10% Speed. Sound: `entity.player.attack.sweep`.
    - **Ranged (State 1)**: -10% Speed (Slowness). Sound: `entity.arrow.shoot`.
    - **On Switch**: +60 Frost (capped by 15s internal CD).

### 9. Mechanic Updates
- **Frost Regeneration Update**:
    - **Base**: 3 points/sec (when safety cooldown implies).
    - **Cold Biome Bonus**: +2 points/sec (Total 5 points/sec).
    - **Logic**: Added biome temperature check (`< 0.15`) inside natural regeneration action.

### 11. Debug Fixes
- **Keybinding Conflict**:
    - **Issue**: `key.origins.primary_active` (G) may be conflicting with other Origin powers or item usage.
    - **Fix**: Temporarily rebound the Toggle Form ability to `key.origins.secondary_active` (Default: O or configurable).
    - **Trigger**: Now **Sneak + Secondary Active Key**.

### 12. Build Status
- **Result**: `BUILD SUCCESSFUL`

---
*Generated by GitHub Copilot*
